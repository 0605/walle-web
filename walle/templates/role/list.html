{% extends "common/base.html" %}
{% block main_content %}
<div class="page-content" id="role_list">
    <div class="row">
        <div class="col-xs-12">
            <div class="box">
                <div class="box-header">
                    <form id="search-form" @submit.prevent="submit">
                        <div class="col-xs-12 col-sm-8" style="padding-left: 0;margin-bottom: 10px;">
                            <div class="input-group">
                                <input type="text" v-model="kw" class="form-control search-query"
                                       placeholder="角色">
                    <span class="input-group-btn">
                        <button type="submit" class="btn btn-default btn-sm">
                            Search
                            <i class="icon-search icon-on-right bigger-110"></i>
                        </button>
                    </span>
                            </div>
                        </div>
                    </form>
                    <a class="btn btn-default btn-sm" href="/role/add/">
                        <i class="icon-pencil align-top bigger-125"></i>
                        添加角色 </a>
                </div><!-- /.box-header -->
                <div class="box-body no-padding clearfix">
                    <table class="table table-striped table-bordered table-hover">
                        <tbody id="table-list">
                        <tr>
                            <th>角色</th>
                            <th>用户数</th>
                            <th>修改时间</th>
                            <th>操作</th>
                        </tr>

                        <tr v-for="item in data">
                            <td>{[ item.name ]}</td>
                            <td>{[ item.name ]}</td>
                            <td>{[ item.updated_at ]}</td>
                            <td>
                                <div class="action-buttons">
                                    <label>
                                        <input class="ace ace-switch ace-switch-5 task-operation" checked=""
                                               type="checkbox" data-id="116">
                                        <span class="lbl"></span>
                                    </label>
                                    <!-- 通过审核可以上线的任务-->

                                    <!-- 回滚的任务不能再回滚-->
                                    <a class="red btn-delete" href="javascript:;" data-id="116">
                                        <i class="icon-trash bigger-130"></i>
                                        删除 </a>
                                </div>
                            </td>
                        </tr>


                        </tbody>
                    </table>
                </div><!-- /.box-body -->
                <ul class="pagination page-bar">
                    <li v-if="current>1"><a v-on:click="current--,pageClick()">«</a></li>
                    <li v-if="current==1"><a class="banclick">«</a></li>
                    <li v-for="index in indexs" v-bind:class="{ 'active': current == index}">
                        <a v-on:click="btnClick(index)">{[ index ]}</a>
                    </li>
                    <li v-if="current!=count"><a v-on:click="current++,pageClick()">»</a></li>
                    <li v-if="current == count" class="next"><a class="banclick">»</a></li>
                    <li><a>共{[count]}页</a></li>
                </ul>
            </div>
        </div><!-- /.col -->
    </div><!-- /.row -->
</div>

{% endblock %}


{% block main_javascript %}
<script type="text/javascript">


    var list_data = null
    $.ajax({
        type: "GET",
        url: "http://localhost:5000/api/role/list",
        dataType: "json",
        success: function (data) {
            list_data = data

            list_table = new Vue({
                el: '#role_list',
                delimiters: ['{[', ']}'],
                data: {
                    data: list_data.data,
                    count: list_data.count, //总页数
                    current: 1,//当前页码
                    kw:''
                },

                watch: {
                    current: function (newPage, oldPage) {
                        this.data = list_data
                        self = this
                        $.get("http://localhost:5000/api/role/list?page=" + newPage + "&kw=" + this.kw + "&size=2", function (data) {
                            self.data = data.data
                            list_table.data = data.data
                        })
                    }
                },
                methods: {
                    btnClick: function (data) {//页码点击事件
                        if (data != this.current) {
                            this.current = data
                        }
                    },
                    pageClick: function () {
                        console.log('现在在' + this.current + '页');
                    },
                    submit: function () {
                        self = this
                        $.post('/api/role/list', {'kw': this.kw}, function (ret) {
                            console.log(ret.data)
                            self.data = ret.data
                            list_data.data = ret.data
                        })
                    }
                },

                computed: {
                    indexs: function () {
                        var left = 1;
                        var right = this.count;
                        var ar = [];
                        if (this.count >= 5) {
                            if (this.current > 3 && this.current < this.count - 2) {
                                left = this.current - 2
                                right = this.current + 2
                            } else {
                                if (this.current <= 3) {
                                    left = 1
                                    right = 5
                                } else {
                                    right = this.count
                                    left = this.count - 4
                                }
                            }
                        }
                        while (left <= right) {
                            ar.push(left)
                            left++
                        }
                        return ar
                    }

                }
            })

        }
    })

</script>

{% endblock %}